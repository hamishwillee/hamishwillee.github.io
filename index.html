<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Document</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
    <meta name="description" content="Description" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0"
    />


        <!-- Start Single Page Apps for GitHub Pages -->
        <!--
        <script type="text/javascript">
          // Single Page Apps for GitHub Pages
          // MIT License
          // https://github.com/rafgraph/spa-github-pages
          // This script checks to see if a redirect is present in the query string,
          // converts it back into the correct url and adds it to the
          // browser's history using window.history.replaceState(...),
          // which won't cause the browser to attempt to load the new url.
          // When the single page app is loaded further down in this file,
          // the correct url will be waiting in the browser's history for
          // the single page app to route accordingly.
          (function(l) {
            if (l.search[1] === '/' ) {
              var decoded = l.search.slice(1).split('&').map(function(s) { 
                return s.replace(/~and~/g, '&')
              }).join('?');
              window.history.replaceState(null, null,
                  l.pathname.slice(0, -1) + decoded + l.hash
              );
            }
          }(window.location))
        </script>
      -->
        <!-- End Single Page Apps for GitHub Pages -->


    <!-- theme options -->
    <!-- simple docsify theme:
    - Very pretty and clean.
    - Sidebar could use some work - ie sectioning not clear
    - Top scrolls

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/css/theme-simple.css">

    -->

    <!-- vue theme : 
    - OK but top bar doesn't scroll


  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css">  
  -->

    <!-- docsify-themeable
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify-darklight-theme@3/dist/docsify-themeable/style.min.css" type="text/css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/css/theme-simple.css" title="light">
  <link rel="stylesheet alternative" href="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/css/theme-simple-dark.css" title="dark">

  -->
    <link
      rel="stylesheet"
      href="//cdn.jsdelivr.net/npm/docsify-darklight-theme@3/dist/docsify-themeable/style.min.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/css/theme-simple.css"
      title="light"
    />
    <link
      rel="stylesheet alternative"
      href="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/css/theme-simple-dark.css"
      title="dark"
    />

    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
  </head>
  <body>
    <style>
      .material-icons.md-18 {
        font-size: 18px;
      }
    </style>
    <nav>
      <select id="lang-selector" name="lang" class="nav-select">
        <option value="en">English</option>
        <option value="ko">한국어 (Korean)</option>
        <option value="zh">中文 (Chinese)</option>
      </select>
      <select id="ver-selector" name="ver" class="nav-select">
        <option value="main">main</option>
        <option value="v1.15">v1.15</option>
      </select>
      <a
        id="edit_link"
        target="_blank"
        title="Edit on Github"
        class="icon-edit"
        style="display: none; font-size: 18px"
        ><span class="material-icons md-18">mode_edit</span></a
      >
    </nav>

    <div id="app"></div>
    <script>
      window.$docsify = {
        name: "PX4 User Guide",
        repo: "https://github.com/PX4/PX4-user_guide",
        //logo: '/assets/logo.png',
        loadSidebar: "SUMMARY.md",
        relativePath: true,
        //loadNavbar: true, // Currently need to use coded navbar to get selectors working.
        //fallbackLanguages: ['zh', 'ko'],  //Not using fallback. This only works back to the "root" so would have to make en/master in the root. Messy.
        maxLevel: 3,
        subMaxLevel: 3,
        routerMode: 'history',
        basePath: 'https://hamishwillee.github.io/multidocsify_test/',
        //This is correct, but will fail as site is too big for localStorage
        search: {
          paths: "auto",
          //namespace: 'px4-website',
          hideOtherSidebarContent: true,
          depth: 4,
          pathNamespaces: /^\/(main|v1\.15){1}\/(zh|en|ko){1}/,
        },

        namespaces: [
          {
            id: "version",
            values: ["main", "v1.15", "redir_repo", "local"],
            optional: false,
            selector: "#ver-selector",
            default: "main",
          },
          {
            id: "lang",
            values: ["en", "zh", "ko"],
            optional: false,
            selector: "#lang-selector",
            default: "en",
          },
        ],

        alias: {
          // Alias for pages where the main version should always be used - put in the contribute folder.
          // Note, this changes the source used - the system still thinks that you're on the original version.
          "/v(\\d+)\.(\\d+)/(en|zh|ko)/contribute/(.*)":
            "https://raw.githubusercontent.com/hamishwillee/PX4-user_guide/main/$3/contribute/$4",

          //General redirects
          "/v(\\d+)\.(\\d+)/(en|zh|ko)/(.*)":
            "https://raw.githubusercontent.com/hamishwillee/PX4-user_guide/v$1.$2/$3/$4",
          "/main/(en|zh|ko)/(.*)":
            "https://raw.githubusercontent.com/hamishwillee/PX4-user_guide/main/$1/$2",

          //PR redirects: /redir_repo/lang/username/reponame/branchname/...
          //Allows any repo in the right format (i.e. with en from root to be imported).
          "/redir_repo/(.*?)/(.*?)/(.*?)/(.*?)/(.*)":
            "https://raw.githubusercontent.com/$2/$3/$4/$1/$5",

          //'/.*/_navbar.md': '/_navbar.md',
        },

        plugins: [
          function (hook, vm) {
            //Fixup images.
            // There's bug that means it can't find them in the tree
            // But we can get them from github as they have relative links
            hook.beforeEach(function (content) {
              let fixcontent = content;

              //General markdown fixes
              if (!vm.isHTML) {
                // Make the github heading anchor format change to docsify format
                fixcontent = fixcontent.replaceAll(
                  /\s*{#([\w-]*)}/g,
                  " :id=$1"
                );

                // Fix up notes/tips with > **Note** syntax.
                fixcontent = fixcontent.replaceAll(
                  "> **Note** ",
                  "\n?> **Note:** "
                );
                fixcontent = fixcontent.replaceAll(
                  "> **Tip** ",
                  "\n?> **Tip:** "
                );
                fixcontent = fixcontent.replaceAll(
                  "> **Warning** ",
                  "\n!> **Warning:** "
                );
                fixcontent = fixcontent.replaceAll(
                  "> **Caution** ",
                  "\n!> **Warning:** "
                );

                // Fix up notes/tips with ::: syntax
                fixcontent = fixcontent.replaceAll(
                  /\:{3}(\S+)$(.*?)\:{3}/gms,
                  (match, type, note_text) => {
                    if (type.startsWith("note")) {
                      return `\n?> **Note:** ${note_text}`;
                    } else if (type.startsWith("tip")) {
                      return `\n?> **Tip:** ${note_text}`;
                    } else if (type.startsWith("warning")) {
                      return `\n!> **Warning:** ${note_text}`;
                    }
                    return match;
                  }
                );

                // Fix up youtube videos in format expected by vuepress.
                // Get the ID then simply turns into IMAGE and link using VID. i.e. it does this as below.
                //[![Alt text](https://img.youtube.com/vi/VID/0.jpg)](https://www.youtube.com/watch?v=VID)
                fixcontent = fixcontent.replaceAll(
                  /\@\[youtube\]\((.*?)\)/g,
                  (match, linkstring) => {
                    let vid = linkstring.split("/").pop();
                    vid = vid.split("?v=").pop();
                    vid = vid.split("&")[0];
                    return `[![Alt text](https://img.youtube.com/vi/${vid}/0.jpg)](https://www.youtube.com/watch?v=${vid})`;
                  }
                );

                fixcontent = fixcontent.replace(
                  "({{ $themeConfig.px4_version }})",
                  ""
                );
              }

              //Fixs just for remote markdown
              if (vm.isRemoteUrl && !vm.isHTML) {
                // Set edit link for the english pages only
                // This might be done nicer. Think about plugin architecture.
                let current_file = vm.route.file;
                current_file = current_file.split("/main/en/");
                const navMenuEditLink = document.getElementById("edit_link");
                if (current_file.length == 2) {
                  let editlink = current_file[1];
                  editlink = `${$docsify.repo}/edit/main/en/${editlink}`;
                  navMenuEditLink.setAttribute("href", editlink);
                  navMenuEditLink.setAttribute("style", "display: inline;");
                } else {
                  navMenuEditLink.setAttribute(
                    "style",
                    "display: none; font-size: 30px;"
                  );
                }

                let my_dir_path = vm.route.file.split("/");
                my_dir_path.pop();

                //Fixup images in Markdown style images to absolute path
                fixcontent = fixcontent.replace(
                  /\!\[(.*?)\]\((.*?)\)/g,
                  (match, title, path) => {
                    let linkrootpath = my_dir_path.slice();
                    let relpath = path;
                    if (relpath.startsWith("../")) {
                      while (relpath.startsWith("../")) {
                        relpath = relpath.slice(3);
                        linkrootpath.pop();
                      }
                      linkrootpath = linkrootpath.join("/");
                      linkrootpath = `${linkrootpath}/${relpath}`;
                      let imagestring = `<img src="${linkrootpath}" title="${title}" />`;
                      return imagestring;
                    } else {
                      return match;
                    }
                  }
                );

                //Fixup images in HTML style images to absolute path
                fixcontent = fixcontent.replace(
                  / src\=["'](.*?)["']/g,
                  (match, path) => {
                    let linkrootpath = my_dir_path.slice();
                    let relpath = path;
                    if (relpath.startsWith("../")) {
                      while (relpath.startsWith("../")) {
                        relpath = relpath.slice(3);
                        linkrootpath.pop();
                      }

                      linkrootpath = linkrootpath.join("/");
                      linkrootpath = `${linkrootpath}/${relpath}`;
                      let imagestring = ` src='${linkrootpath}'`;
                      return imagestring;
                    } else {
                      return match;
                    }
                  }
                );

                //Fix up relative links reference:
                //[rcircle]: ../../assets/hardware/cables/red.png
                fixcontent = fixcontent.replace(
                  /^(\[.*?\]\:) (.*?)$/gm,
                  (match, title, path) => {
                    console.log(match);
                    let linkrootpath = my_dir_path.slice();
                    let relpath = path;
                    if (relpath.startsWith("../")) {
                      while (relpath.startsWith("../")) {
                        relpath = relpath.slice(3);
                        linkrootpath.pop();
                      }
                      linkrootpath = linkrootpath.join("/");
                      linkrootpath = `${linkrootpath}/${relpath}`;
                      let relativelink = `${title} ${linkrootpath}`;
                      return relativelink;
                    } else {
                      return match;
                    }
                  }
                );
              }

              //Return the modified content
              return fixcontent;
            }); //End of this hook
          },
        ], //end of all plugins
      };
    </script>
    <!-- Docsify v4 -->
    <script src="//cdn.jsdelivr.net/npm/docsify@4"></script>

    <!-- docsify-themeable -->

    <script src="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/js/docsify-themeable.min.js"></script>

    <!-- docsify-themeable darklight -->
    <!--
  <script
    src="//cdn.jsdelivr.net/npm/docsify-darklight-theme@3/dist/docsify-themeable/main.min.js"
    type="text/javascript">
  </script>
  <script
    src="//cdn.jsdelivr.net/npm/docsify-darklight-theme@3/dist/docsify-themeable/index.min.js"
    type="text/javascript">
  </script>

    -->
    <script
      src="//cdn.jsdelivr.net/npm/docsify-darklight-theme@3/dist/docsify-themeable/main.min.js"
      type="text/javascript"
    ></script>
    <!-- Updated script for the theme -->

    <!--
  <script
    src="https://cdn.jsdelivr.net/gh/hamishwillee/multidocsify_test@px4test_docsify/docsify_darklight_navbar.js"
    type="text/javascript">
  </script>

  -->

    <!-- During development
	  -->
    <script src="./docsify_darklight_navbar.js" type="text/javascript"></script>

    <!-- sidebar collapse: https://github.com/iPeng6/docsify-sidebar-collapse 
  
  -->
    <script src="//cdn.jsdelivr.net/npm/docsify-sidebar-collapse/dist/docsify-sidebar-collapse.min.js"></script>

    <!-- Namespaces: https://evilmartians.com/chronicles/easy-multi-language-multi-version-documentation-with-docsify-git-and-github-actions  -->
    <!-- <script src="https://unpkg.com/docsify-namespaced" crossorigin="anonymous"></script> --> <!-- try on jsdelivr -->
    <script src="https://unpkg.com/docsify-namespaced@0.1.1/dist/docsify-namespaced.js"></script>

    <!-- full text search: very cool but does not work on our size of database - though it might with some hints -->
    <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>

    <!-- zoom image -->
    <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/zoom-image.min.js"></script>
  </body>
</html>
